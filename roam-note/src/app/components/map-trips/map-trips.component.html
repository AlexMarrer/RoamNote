<div class="map-trips">
  <div class="map-trips__map-layer">
    <!-- Loading Spinner -->
    <div *ngIf="isMapLoading" class="map-trips__loading">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p class="map-trips__loading-text">Karte wird geladen...</p>
    </div>

    <capacitor-google-map
      #mapRef
      class="map-trips__map-element"
      [class.map-trips__map-element--loading]="isMapLoading"
    ></capacitor-google-map>

    <!-- Location FAB Button -->
    <ion-fab-button
      class="map-trips__location-fab"
      size="small"
      (click)="centerOnUserPosition()"
      (keydown.enter)="centerOnUserPosition()"
      aria-label="Zu meinem Standort wechseln"
    >
      <ion-icon name="locate"></ion-icon>
    </ion-fab-button>
  </div>

  <div class="map-trips__trips-panel">
    <ion-accordion-group
      class="map-trips__accordion-group"
      (ionChange)="onAccordionChange()"
    >
      <ion-accordion
        *ngFor="let trip of trips; trackBy: trackByTripId"
        [value]="trip.id"
        class="map-trips__trip"
      >
        <ion-item slot="header" color="light" class="map-trips__trip-header">
          <ion-label>
            <h2 class="map-trips__trip-title">{{ trip.name }}</h2>
            <p *ngIf="trip.description" class="map-trips__trip-description">
              {{ trip.description }}
            </p>
          </ion-label>
        </ion-item>

        <div class="map-trips__trip-content ion-padding" slot="content">
          <ion-list class="map-trips__spots-list">
            <ion-item-sliding
              class="map-trips__sliding"
              *ngFor="let spot of trip.spots; trackBy: trackBySpotId"
            >
              <ion-item
                class="map-trips__sliding-item map-trips__spot"
                button
                detail="true"
                (click)="onSpotClick(spot)"
                (keydown.enter)="onSpotClick(spot)"
              >
                <ion-label>
                  <h3 class="map-trips__spot-name">{{ spot.name }}</h3>
                  <p
                    *ngIf="spot.description"
                    class="map-trips__spot-description"
                  >
                    {{ spot.description }}
                  </p>
                </ion-label>
              </ion-item>

              <ion-item-options side="end" class="map-trips__sliding-options">
                <ion-item-option
                  class="map-trips__sliding-option"
                  color="primary"
                  (click)="editSpot(spot, trip)"
                  (keypress)="editSpot(spot, trip)"
                >
                  <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                </ion-item-option>
                <ion-item-option
                  class="map-trips__sliding-option"
                  color="danger"
                  (click)="deleteSpot(spot, trip)"
                  (keypress)="deleteSpot(spot, trip)"
                >
                  <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </div>
</div>
